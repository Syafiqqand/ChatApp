<Window x:Class="ChatClient.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ChatClient"
        mc:Ignorable="d"
        Title="Chat Client" Height="450" Width="800"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource Window.Background}">
    <Window.Resources>
        <Style x:Key="ThemeToggleStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="25"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border x:Name="border" BorderBrush="{DynamicResource Border.Primary}" BorderThickness="1" CornerRadius="12">
                            <Grid>
                                <Rectangle x:Name="background" Fill="{DynamicResource SidePanel.Background}" RadiusX="12" RadiusY="12"/>
                                <Ellipse x:Name="thumb" Fill="{DynamicResource Text.Secondary}" Width="19" Height="19" HorizontalAlignment="Left" Margin="3"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="thumb" Property="HorizontalAlignment" Value="Right"/>
                                <Setter TargetName="background" Property="Fill" Value="LightSkyBlue"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" 
                Background="{DynamicResource SidePanel.Background}" 
                BorderBrush="{DynamicResource Border.Primary}" 
                BorderThickness="0,0,1,0">

            <StackPanel>
                <TextBlock Text="Online Users" FontWeight="Bold" Padding="10" HorizontalAlignment="Center" 
                           Background="{DynamicResource Header.Background}" Margin="0,0,0,5"
                           Foreground="{DynamicResource Text.Primary}"/>
                <TextBlock Text="Double-click to PM" FontSize="10" HorizontalAlignment="Center" 
                           Foreground="{DynamicResource Text.Secondary}" Margin="0,0,0,5"/>

                <ListBox x:Name="lstOnlineUsers" 
                         Margin="5" 
                         BorderThickness="0"
                         Background="Transparent"
                         MouseDoubleClick="lstOnlineUsers_MouseDoubleClick"
                         HorizontalContentAlignment="Stretch">

                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <ContentPresenter/>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource UserItem.Background}" 
                                    BorderBrush="{DynamicResource Border.Secondary}" 
                                    BorderThickness="1" 
                                    Margin="4,2">
                                <TextBlock Text="{Binding}" 
                                           Padding="10,5"
                                           VerticalAlignment="Center" 
                                           HorizontalAlignment="Left" 
                                           Foreground="{DynamicResource Text.Primary}"
                                           FontWeight="SemiBold"/>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </Border>

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" BorderBrush="{DynamicResource Border.Primary}" BorderThickness="0,0,0,1" Padding="5">
                <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top">
                    <StackPanel Orientation="Vertical" Margin="2">
                        <TextBlock Text="Alamat IP" FontSize="12" Margin="5,0,5,2" Foreground="{DynamicResource Text.Primary}"/>
                        <TextBox x:Name="txtServerIP" Text="127.0.0.1" Width="100" Margin="5,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Vertical" Margin="2">
                        <TextBlock Text="Port" FontSize="12" Margin="5,0,5,2" Foreground="{DynamicResource Text.Primary}"/>
                        <TextBox x:Name="txtPort" Text="8080" Width="50" Margin="5,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Vertical" Margin="2">
                        <TextBlock Text="Username" FontSize="12" Margin="5,0,5,2" Foreground="{DynamicResource Text.Primary}"/>
                        <TextBox x:Name="txtUsername" Width="120" Margin="5,0" ToolTip="Enter your username"/>
                    </StackPanel>

                    <StackPanel Orientation="Vertical" Margin="8,0,0,0" VerticalAlignment="Bottom">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <Button x:Name="btnConnect" Content="Connect" Click="btnConnect_Click" Margin="5,0" Width="70"/>
                            <Button x:Name="btnDisconnect" Content="Disconnect" Click="btnDisconnect_Click" Margin="5,0" Width="70" IsEnabled="False"/>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel VerticalAlignment="Center" Margin="15,5,0,0">
                        <TextBlock Text="Dark Mode" FontSize="10" HorizontalAlignment="Center" Foreground="{DynamicResource Text.Secondary}" Margin="0,0,0,2"/>
                        <ToggleButton x:Name="ThemeToggleButton" 
                                      Style="{StaticResource ThemeToggleStyle}" 
                                      Click="ThemeToggleButton_Click"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <TextBlock Grid.Row="1" x:Name="txtStatus" Text="Disconnected" Margin="10,5" Foreground="{DynamicResource Text.Disconnected}"/>

            <ListBox Grid.Row="2" x:Name="lstMessages" Margin="10,0,10,10" ScrollViewer.VerticalScrollBarVisibility="Auto"
                     Background="{DynamicResource ListBox.Background}" BorderBrush="{DynamicResource Border.Primary}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" TextWrapping="Wrap" Foreground="{DynamicResource Text.Primary}"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <TextBlock x:Name="lblTypingStatus"
                       Grid.Row="3"
                       Margin="15,0,10,2"
                       Foreground="{DynamicResource Text.Secondary}"
                       FontStyle="Italic"
                       VerticalAlignment="Center"/>

            <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="10,0,10,10" VerticalAlignment="Center">
                <TextBlock x:Name="lblPmTarget" 
                           VerticalAlignment="Center" 
                           Margin="5,0" 
                           Foreground="{DynamicResource Text.PM}" 
                           FontWeight="Bold" 
                           Visibility="Collapsed"/>

                <TextBox x:Name="txtMessage" Width="420" Margin="5" 
                         KeyDown="txtMessage_KeyDown" IsEnabled="False"
                         TextChanged="txtMessage_TextChanged"
                         ToolTip="Type your message here"/>
                <Button x:Name="btnSend" Content="Send" Click="btnSend_Click" Margin="5" Width="70" IsEnabled="False"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>